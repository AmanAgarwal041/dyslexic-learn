{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/esm/objectSpread\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/promise\"));\n\nvar _ramda = require(\"ramda\");\n\nvar _apolloClient = require(\"apollo-client\");\n\nvar _apolloCacheInmemory = require(\"apollo-cache-inmemory\");\n\nvar _apolloLinkHttp = require(\"apollo-link-http\");\n\nvar _apolloLinkError = require(\"apollo-link-error\");\n\nvar _apolloLink = require(\"apollo-link\");\n\nvar _isomorphicUnfetch = _interopRequireDefault(require(\"isomorphic-unfetch\"));\n\nvar _config = _interopRequireDefault(require(\"../config\"));\n\nvar cache = function cache() {\n  var initialState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return new _apolloCacheInmemory.InMemoryCache().restore(initialState);\n};\n\nvar requestLink = new _apolloLink.ApolloLink(function (operation, forward) {\n  return new _apolloLink.Observable(function (observer) {\n    var handle;\n\n    _promise[\"default\"].resolve(operation).then(function () {\n      handle = forward(operation).subscribe({\n        next: observer.next.bind(observer),\n        error: observer.error.bind(observer),\n        complete: observer.complete.bind(observer)\n      });\n    })[\"catch\"](observer.error.bind(observer));\n\n    return function () {\n      if (handle) handle.unsubscribe();\n    };\n  });\n});\n\nmodule.exports = function (initialState) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$req = _ref.req;\n\n  _ref$req = _ref$req === void 0 ? {} : _ref$req;\n  var _ref$req$headers = _ref$req.headers,\n      headers = _ref$req$headers === void 0 ? {} : _ref$req$headers;\n  headers.devicetype = 'ogma';\n  var omittedHeaders = (0, _ramda.omit)(['cf-ray', 'cf-connecting-ip', 'upgrade-insecure-requests', 'accept', 'host'])(headers);\n\n  if (_config[\"default\"].graph.authorizationHeader) {\n    omittedHeaders = (0, _objectSpread2[\"default\"])({}, omittedHeaders, {\n      authorization: _config[\"default\"].graph.authorizationHeader\n    });\n  }\n\n  return new _apolloClient.ApolloClient({\n    ssrMode: true,\n    link: _apolloLink.ApolloLink.from([(0, _apolloLinkError.onError)(function (_ref2) {\n      var graphQLErrors = _ref2.graphQLErrors,\n          networkError = _ref2.networkError;\n      if (graphQLErrors) graphQLErrors.forEach(function (_ref3) {\n        var message = _ref3.message,\n            locations = _ref3.locations,\n            path = _ref3.path;\n        return console.log(\"[GraphQL error]: Message: \".concat(message, \", Location: \").concat(locations, \", Path: \").concat(path));\n      });\n      if (networkError) console.log(\"[Network error]: \".concat(networkError));\n    }), requestLink, new _apolloLinkHttp.HttpLink({\n      uri: _config[\"default\"].graph.url,\n      credentials: 'include',\n      headers: omittedHeaders,\n      fetch: _isomorphicUnfetch[\"default\"]\n    })]),\n    cache: cache(initialState)\n  });\n};","map":{"version":3,"sources":["/Users/admin/hackathon-project/dyslexic-learn/front-end/apollo/index.js"],"names":["cache","initialState","InMemoryCache","restore","requestLink","ApolloLink","operation","forward","Observable","observer","handle","resolve","then","subscribe","next","bind","error","complete","unsubscribe","module","exports","req","headers","devicetype","omittedHeaders","config","graph","authorizationHeader","authorization","ApolloClient","ssrMode","link","from","graphQLErrors","networkError","forEach","message","locations","path","console","log","HttpLink","uri","url","credentials","fetch"],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA,IAAMA,KAAK,GAAG,SAARA,KAAQ;AAAA,MAACC,YAAD,uEAAgB,EAAhB;AAAA,SAAuB,IAAIC,kCAAJ,GAAoBC,OAApB,CAA4BF,YAA5B,CAAvB;AAAA,CAAd;;AAEA,IAAMG,WAAW,GAAG,IAAIC,sBAAJ,CAAe,UAACC,SAAD,EAAYC,OAAZ;AAAA,SAClC,IAAIC,sBAAJ,CAAe,UAAAC,QAAQ,EAAI;AAC1B,QAAIC,MAAJ;;AACA,wBAAQC,OAAR,CAAgBL,SAAhB,EACEM,IADF,CACO,YAAM;AACXF,MAAAA,MAAM,GAAGH,OAAO,CAACD,SAAD,CAAP,CAAmBO,SAAnB,CAA6B;AACrCC,QAAAA,IAAI,EAAEL,QAAQ,CAACK,IAAT,CAAcC,IAAd,CAAmBN,QAAnB,CAD+B;AAErCO,QAAAA,KAAK,EAAEP,QAAQ,CAACO,KAAT,CAAeD,IAAf,CAAoBN,QAApB,CAF8B;AAGrCQ,QAAAA,QAAQ,EAAER,QAAQ,CAACQ,QAAT,CAAkBF,IAAlB,CAAuBN,QAAvB;AAH2B,OAA7B,CAAT;AAKA,KAPF,WAQQA,QAAQ,CAACO,KAAT,CAAeD,IAAf,CAAoBN,QAApB,CARR;;AAUA,WAAO,YAAM;AACZ,UAAIC,MAAJ,EAAYA,MAAM,CAACQ,WAAP;AACZ,KAFD;AAGA,GAfD,CADkC;AAAA,CAAf,CAApB;;AAmBAC,MAAM,CAACC,OAAP,GAAiB,UAACnB,YAAD,EAAuD;AAAA,iFAAP,EAAO;AAAA,sBAAtCoB,GAAsC;;AAAA,mCAAd,EAAc;AAAA,kCAA/BC,OAA+B;AAAA,MAA/BA,OAA+B,iCAArB,EAAqB;AACvEA,EAAAA,OAAO,CAACC,UAAR,GAAqB,MAArB;AAEA,MAAIC,cAAc,GAAG,iBAAK,CACzB,QADyB,EAEzB,kBAFyB,EAGzB,2BAHyB,EAIzB,QAJyB,EAKzB,MALyB,CAAL,EAMlBF,OANkB,CAArB;;AAQA,MAAIG,mBAAOC,KAAP,CAAaC,mBAAjB,EAAsC;AACrCH,IAAAA,cAAc,sCACVA,cADU;AAEbI,MAAAA,aAAa,EAAEH,mBAAOC,KAAP,CAAaC;AAFf,MAAd;AAIA;;AAED,SAAO,IAAIE,0BAAJ,CAAiB;AACvBC,IAAAA,OAAO,EAAE,IADc;AAEvBC,IAAAA,IAAI,EAAE1B,uBAAW2B,IAAX,CAAgB,CACrB,8BAAQ,iBAAqC;AAAA,UAAlCC,aAAkC,SAAlCA,aAAkC;AAAA,UAAnBC,YAAmB,SAAnBA,YAAmB;AAC5C,UAAID,aAAJ,EACCA,aAAa,CAACE,OAAd,CAAsB;AAAA,YAAGC,OAAH,SAAGA,OAAH;AAAA,YAAYC,SAAZ,SAAYA,SAAZ;AAAA,YAAuBC,IAAvB,SAAuBA,IAAvB;AAAA,eACrBC,OAAO,CAACC,GAAR,qCAC8BJ,OAD9B,yBACoDC,SADpD,qBACwEC,IADxE,EADqB;AAAA,OAAtB;AAMD,UAAIJ,YAAJ,EAAkBK,OAAO,CAACC,GAAR,4BAAgCN,YAAhC;AAClB,KATD,CADqB,EAWrB9B,WAXqB,EAYrB,IAAIqC,wBAAJ,CAAa;AACZC,MAAAA,GAAG,EAAEjB,mBAAOC,KAAP,CAAaiB,GADN;AAEZC,MAAAA,WAAW,EAAE,SAFD;AAGZtB,MAAAA,OAAO,EAAEE,cAHG;AAIZqB,MAAAA,KAAK,EAALA;AAJY,KAAb,CAZqB,CAAhB,CAFiB;AAqBvB7C,IAAAA,KAAK,EAAEA,KAAK,CAACC,YAAD;AArBW,GAAjB,CAAP;AAuBA,CAzCD","sourcesContent":["import { omit } from 'ramda';\nimport { ApolloClient } from 'apollo-client';\nimport { InMemoryCache } from 'apollo-cache-inmemory';\nimport { HttpLink } from 'apollo-link-http';\nimport { onError } from 'apollo-link-error';\nimport { ApolloLink, Observable } from 'apollo-link';\nimport fetch from 'isomorphic-unfetch';\nimport config from '../config';\n\nconst cache = (initialState = {}) => new InMemoryCache().restore(initialState);\n\nconst requestLink = new ApolloLink((operation, forward) =>\n\tnew Observable(observer => {\n\t\tlet handle;\n\t\tPromise.resolve(operation)\n\t\t\t.then(() => {\n\t\t\t\thandle = forward(operation).subscribe({\n\t\t\t\t\tnext: observer.next.bind(observer),\n\t\t\t\t\terror: observer.error.bind(observer),\n\t\t\t\t\tcomplete: observer.complete.bind(observer),\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(observer.error.bind(observer));\n\n\t\treturn () => {\n\t\t\tif (handle) handle.unsubscribe();\n\t\t};\n\t})\n);\n\nmodule.exports = (initialState, { req: { headers = {} } = {} } = {}) => {\n\theaders.devicetype = 'ogma';\n\n\tlet omittedHeaders = omit([\n\t\t'cf-ray',\n\t\t'cf-connecting-ip',\n\t\t'upgrade-insecure-requests',\n\t\t'accept',\n\t\t'host',\n\t])(headers);\n\n\tif (config.graph.authorizationHeader) {\n\t\tomittedHeaders = {\n\t\t\t...omittedHeaders,\n\t\t\tauthorization: config.graph.authorizationHeader,\n\t\t};\n\t}\n\t\n\treturn new ApolloClient({\n\t\tssrMode: true,\n\t\tlink: ApolloLink.from([\n\t\t\tonError(({ graphQLErrors, networkError }) => {\n\t\t\t\tif (graphQLErrors)\n\t\t\t\t\tgraphQLErrors.forEach(({ message, locations, path }) =>\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t`[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\n\t\t\t\tif (networkError) console.log(`[Network error]: ${networkError}`);\n\t\t\t}),\n\t\t\trequestLink,\n\t\t\tnew HttpLink({\n\t\t\t\turi: config.graph.url,\n\t\t\t\tcredentials: 'include',\n\t\t\t\theaders: omittedHeaders,\n\t\t\t\tfetch,\n\t\t\t})\n\t\t]),\n\t\tcache: cache(initialState)\n\t});\n};"]},"metadata":{},"sourceType":"script"}